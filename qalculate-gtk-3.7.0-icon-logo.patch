From f64eef8509af8dfe7a1fad1359b46edd81ebd83b Mon Sep 17 00:00:00 2001
From: Hanna K <hanna.knutsson@protonmail.com>
Date: Mon, 27 Jan 2020 09:05:32 +0100
Subject: [PATCH] Fix about dialog logo (issue #130)

---
 data/ui.gresource.xml |  2 ++
 src/callbacks.cc      |  1 +
 src/interface.cc      |  3 ---
 src/main.cc           | 16 ++++------------
 4 files changed, 7 insertions(+), 15 deletions(-)

diff --git a/data/ui.gresource.xml b/data/ui.gresource.xml
index 788aaca..7c88bc0 100644
--- a/data/ui.gresource.xml
+++ b/data/ui.gresource.xml
@@ -36,5 +36,7 @@
 		<file alias="32x32/actions/rpn-swap-symbolic.symbolic.png">icons/32x32/rpn-swap-symbolic.png</file>
 		<file alias="48x48/actions/rpn-swap-symbolic.symbolic.png">icons/48x48/rpn-swap-symbolic.png</file>
 		<file alias="64x64/actions/rpn-swap-symbolic.symbolic.png">icons/64x64/rpn-swap-symbolic.png</file>
+		<file alias="64x64/apps/qalculate.png">icons/64x64/qalculate.png</file>
+		<file alias="scalable/apps/qalculate.png">icons/scalable/qalculate.svg</file>
 	</gresource>
 </gresources>
diff --git a/src/callbacks.cc b/src/callbacks.cc
index 6aed1db..c579fd3 100644
--- a/src/callbacks.cc
+++ b/src/callbacks.cc
@@ -25864,6 +25864,7 @@ void on_menu_item_about_activate(GtkMenuItem*, gpointer) {
 	gtk_about_dialog_set_comments(GTK_ABOUT_DIALOG(dialog), _("Powerful and easy to use calculator"));
 	gtk_about_dialog_set_license_type(GTK_ABOUT_DIALOG(dialog), GTK_LICENSE_GPL_2_0);
 	gtk_about_dialog_set_copyright(GTK_ABOUT_DIALOG(dialog), "Copyright © 2003–2007, 2008, 2016-2019 Hanna Knutsson");
+	gtk_about_dialog_set_logo_icon_name(GTK_ABOUT_DIALOG(dialog), "qalculate");
 	gtk_about_dialog_set_program_name(GTK_ABOUT_DIALOG(dialog), "Qalculate! (GTK+)");
 	gtk_about_dialog_set_version(GTK_ABOUT_DIALOG(dialog), VERSION);
 	gtk_about_dialog_set_website(GTK_ABOUT_DIALOG(dialog), "http://qalculate.github.io/");
diff --git a/src/interface.cc b/src/interface.cc
index b5021c4..18bdd0a 100644
--- a/src/interface.cc
+++ b/src/interface.cc
@@ -1016,9 +1016,6 @@ void create_button_menus(void) {
 
 void create_main_window(void) {
 
-	GtkIconTheme * theme = gtk_icon_theme_get_default();
-	gtk_icon_theme_add_resource_path(theme, "/qalculate-gtk/icons");
-
 	main_builder = getBuilder("main.ui");
 	g_assert(main_builder != NULL);
 
diff --git a/src/main.cc b/src/main.cc
index c4e036d..fc267b5 100644
--- a/src/main.cc
+++ b/src/main.cc
@@ -86,18 +86,10 @@ static GOptionEntry options[] = {
 
 void create_application(GtkApplication *app) {
 
-#ifdef _WIN32
-	char exepath[MAX_PATH];
-	GetModuleFileName(NULL, exepath, MAX_PATH);
-	string datadir(exepath);
-	gchar *icon_path;
-	if(datadir.find("\\.libs") != string::npos) icon_path = g_build_filename(getPackageDataDir().c_str(), "data", "qalculate.png", NULL);
-	else icon_path = g_build_filename(getPackageDataDir().c_str(), "pixmaps", "qalculate.png", NULL);
-#else
-	gchar *icon_path = g_build_filename(getPackageDataDir().c_str(), "pixmaps", "qalculate.png", NULL);
-#endif
-	gtk_window_set_default_icon_from_file(icon_path, NULL);
-	g_free(icon_path);
+	GtkIconTheme *theme = gtk_icon_theme_get_default();
+	gtk_icon_theme_add_resource_path(theme, "/qalculate-gtk/icons");
+
+	gtk_window_set_default_icon_name("qalculate");
 
 	b_busy = false;
 	b_busy_result = false;
